<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>QRã‚¹ã‚­ãƒ£ãƒŠãƒ¼</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 0; padding: 0; }
    video { width: 100%; max-height: 50vh; }
    ul { padding: 0; list-style: none; }
    li { padding: 4px 8px; border-bottom: 1px solid #ccc; display: flex; justify-content: space-between; align-items: center; }
    .container { padding: 20px; }
    .btn { margin: 5px; padding: 5px 10px; font-size: 14px; }
  </style>
</head>
<body>
  <h2>QRã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒŠãƒ¼</h2>
  <video id="video" autoplay></video>

  <div class="container">
    <h3>èª­ã¿å–ã‚Šæ¸ˆã¿ãƒªãƒ³ã‚¯</h3>
    <ul id="qrList"></ul>
    <button class="btn" onclick="clearList()">ğŸ§¹ ã™ã¹ã¦ã‚¯ãƒªã‚¢</button>
  </div>

  <script src="https://unpkg.com/@zxing/browser@0.0.10/umd/index.min.js"></script>
  <script>
    const scannedLinks = new Set();
    const list = document.getElementById('qrList');

    // ãƒªã‚¹ãƒˆã«è¡¨ç¤ºã™ã‚‹é–¢æ•°
    function addLinkToList(url) {
      const match = url.match(/record=(\d+)/);
      const id = match ? match[1] : 'ä¸æ˜';

      const li = document.createElement('li');
      li.innerHTML = `ID: ${id} <button class="btn" onclick="removeItem(this)">âŒ</button>`;
      li.dataset.url = url;
      li.onclick = () => window.open(url, '_blank');
      list.appendChild(li);
    }

    // ã‚¢ã‚¤ãƒ†ãƒ å‰Šé™¤
    function removeItem(btn) {
      const li = btn.parentElement;
      list.removeChild(li);
      scannedLinks.delete(li.dataset.url);
    }

    // å…¨å‰Šé™¤
    function clearList() {
      if (confirm('ã™ã¹ã¦ã®ãƒªãƒ³ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        list.innerHTML = '';
        scannedLinks.clear();
      }
    }

    // ã‚¹ã‚­ãƒ£ãƒ³å‡¦ç†
    async function startScanner() {
      const codeReader = new ZXing.BrowserQRCodeReader();
      const videoInputDevices = await codeReader.getVideoInputDevices();
      const selectedDeviceId = videoInputDevices[0]?.deviceId;

      codeReader.decodeFromVideoDevice(selectedDeviceId, 'video', (result, err) => {
        if (result) {
          const url = result.getText();
          if (!scannedLinks.has(url)) {
            scannedLinks.add(url);
            addLinkToList(url);
          }
        }
      });
    }

    startScanner().catch(e => alert('ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„ã‹ã€ãƒ‡ãƒã‚¤ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚'));
  </script>
</body>
</html>
