<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>QRスキャナー</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 0; padding: 0; }
    #container { padding: 10px; }
    video { width: 100%; max-height: 50vh; }
    #qrList { list-style: none; padding: 0; margin-top: 10px; }
    #qrList li { margin: 5px 0; }
    button { margin: 5px; padding: 5px 10px; }
  </style>
</head>
<body>
  <h2>QRスキャナー</h2>
  <video id="preview"></video>
  <div id="container">
    <ul id="qrList"></ul>
    <button id="clearBtn">全クリア</button>
  </div>

  <script src="https://unpkg.com/html5-qrcode"></script>
  <script>
    const qrList = document.getElementById('qrList');
    const clearBtn = document.getElementById('clearBtn');
    const scanned = new Set();

    const html5QrCode = new Html5Qrcode("preview");
    html5QrCode.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      qrCodeMessage => {
        if (scanned.has(qrCodeMessage)) return;
        scanned.add(qrCodeMessage);
        const li = document.createElement('li');
        const link = document.createElement('a');
        link.href = qrCodeMessage;
        link.textContent = qrCodeMessage;
        link.target = "_blank";
        li.appendChild(link);

        const delBtn = document.createElement('button');
        delBtn.textContent = "削除";
        delBtn.onclick = () => {
          qrList.removeChild(li);
          scanned.delete(qrCodeMessage);
        };
        li.appendChild(delBtn);

        qrList.appendChild(li);
      },
      errorMessage => { /* 無視 */ }
    );

    clearBtn.onclick = () => {
      qrList.innerHTML = '';
      scanned.clear();
    };
  </script>
</body>
</html>
